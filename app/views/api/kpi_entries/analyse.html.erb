<div>
     <div class="chart-body" id="chart-body" style="display:none">
          <div class="clearfix" id="chart-interval-alternate" my_height="28">
               <ul class="pull-right control-chart-interval-group">
                    <li interval="90">
                         <a>Hr</a>
                    </li>
                    <li interval="100">
                         <a>D</a>
                    </li>
                    <li interval="200">
                         <a>W</a>
                    </li>
                    <li interval="300">
                         <a>M</a>
                    </li>
                    <li interval="400">
                         <a>Qr</a>
                    </li>
                    <li interval="500">
                         <a>Y</a>
                    </li>
               </ul>
          </div>
          <div class="relative" id="chart-main-middle">
               <div class="chart-container " id="chart-container"></div>
               <div id="chart-point-detail" class="chart-point-detail">
                    <table class="chart-detail-table">
                         <thead>
                              <tr>
                                   <td colspan="2" align="center" id="chart-detail-kpi" ></td>
                              </tr>
                         </thead>
                         <tbody>
                              <tr>
                                   <td width="80px"  align="right"><%= t 'analytics.date'%>:</td>
                                   <td id="date" align="left"></td>
                              </tr>
                              <tr>
                                   <td width="80px"  align="right"><%= t 'analytics.begin_time'%>:</td>
                                   <td id="from" align="left"></td>
                              </tr>
                              <tr class="hide">
                                   <td width="80px"  align="right"><%= t 'analytics.end_time'%>:</td>
                                   <td id="to" align="left"></td>
                              </tr>
                              <tr class="hide">
                                   <td width="80px"  align="right"><%= t 'analytics.percent'%>:</td>
                                   <td id="percent" align="left"></td>
                              </tr>
                              <tr>
                                   <td width="80px"  align="right"><%= t 'analytics.sum_target'%>:</td>
                                   <td id="sum-target" align="left"></td>
                              </tr>
                              <tr>
                                   <td width="80px"  align="right"><%= t 'analytics.sum_value'%>:</td>
                                   <td id="sum-value" align="left"></td>
                              </tr>
                              <tr>
                                   <td width="80px"  align="right">目标上限:</td>
                                   <td id="target-max" align="left"></td>
                              </tr>
                              <tr>
                                   <td width="80px"  align="right">目标下限:</td>
                                   <td id="target-min" align="left"></td>
                              </tr>
                              <tr class="hide">
                                   <td width="80px"  align="right"><%= t 'analytics.aver_target'%>:</td>
                                   <td id="aver-target" align="left"></td>
                              </tr>
                              <tr>
                                   <td width="80px"  align="right"><%= t 'analytics.value'%>:</td>
                                   <td id="value" align="left"></td>
                              </tr>
                              <tr class="hide">
                                   <td width="80px"  align="right"><%= t 'analytics.aver_value'%>:</td>
                                   <td id="aver-value" align="left"></td>
                              </tr>
                              <tr>
                                   <td width="80px"  align="right"><%= t 'analytics.tcr'%>:</td>
                                   <td id="tcr" align="left"></td>
                              </tr>
                         </tbody>
                    </table>
                    <div class="chart-detail-close" id="chart-detail-close" onclick="close_chart_detail()">
                         <%= t 'analytics.close_btn'%>
                    </div>
               </div>
          </div>
          <table class="chart-type-alternate" id="chart-type-alternate"  my_height="70">
               <tr>
                    <td class="analytics-chart-line image" type="line">
                    <p style="display:block">
                         Line
                    </p></td>
                    <td class="analytics-chart-column" type="column">
                    <p>
                         Column
                    </p></td>

                    <td class="analytics-chart-scatter" type="scatter">
                    <p>
                         Scatter
                    </p></td>
               </tr>
          </table>
     </div>
</div>
<input type="hidden" value="<%= @kpi_id%>" id="kpi-id-hidden"/>
<input type="hidden" value="<%= @entity_group_id%>" id="entity-group-id-hidden"/>
<input type="hidden" value="<%= @start_time%>" id="start-time-hidden"/>
<input type="hidden" value="<%= @end_time%>" id="end-time-hidden"/>
<input type="hidden" value="<%= @frequency%>" id="frequency-hidden" />
<input type="hidden" value="<%= @type%>" id="type-hidden" />
<% content_for :javascript_includes do%>
<%= javascript_include_tag "highstock.js"%>
<%= javascript_include_tag "exporting.js"%>
<%= javascript_include_tag "exporting.extend.src.js"%>
<%= javascript_include_tag "high_chart_template_analytic.js"%>
<%= javascript_include_tag "Analytics_init.js"%>
<%end%>

<script>
     $(document).ready(function() {
          resize_chart.body();
          resize_chart.container();
          function prepare_form_chart() {
               var kpi = $("#kpi-id-hidden").val();
               var view = $("#entity-group-id-hidden").val();
               var view_text = "test";
               var method = $("input[name='chartRadios']:checked").attr("value");
               var interval, type, chart_body_close_validate
              
               var  interval=$("#entity-group-id-hidden").val()
               var begin_time = $("#analy-begin-time").attr("hide_value"), end_time = $("#analy-end-time").attr("hide_value");
               if(kpi && begin_time && view) {
                    if(end_time) {
                         var compare_result = compare_time(begin_time, end_time);
                         begin_time = compare_result.begin;
                         end_time = compare_result.end;
                    } else {
                         end_time = begin_time
                    }

                    var option = {
                         kpi : $("#chart-kpi :selected").text(),
                         kpi_id : kpi,
                         target : "chart-container",
                         begin_time : begin_time,
                         end_time : end_time,
                         type : type,
                         interval : interval,
                         count : ANALYTICS.chartSeries.count + 1,
                         view : view,
                         view_text : view_text,
                         method : method,
                         chart_body_close_validate : chart_body_close_validate
                    };
                    ANALYTICS.chartSeries.addCount();
                    ANALYTICS.chartSeries.id_give();
                    option.id = ANALYTICS.chartSeries.id;
                    ANALYTICS.chartSeries.addSeries(option);
                    if(option.chart_body_close_validate) {
                         show_chart_body(option);
                    }
                    ANALYTICS.form_chart(option);
               } else {
                    MessageBox("please fill all blanks in *", "top", "warning")
               }
          }

     });
     $(window).resize(function() {
          resize_chart.body();
          resize_chart.container();
     }); 
</script>