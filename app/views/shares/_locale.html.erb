<li class="select-language" id="select-language">
  <span lan="<%= I18n.locale %>"><%= t 'epm.base.language'%></span>
  <i class="icon-caret-down"></i>
  <ul class="menu-select-language" id="menu-select-language">
    <li lan="zh" >中文</li>
    <li lan="en" >English</li>
  </ul>
</li>

<script type="text/javascript">
  $("body").on("click","#menu-select-language li",function(){
      var value=$(this).attr("lan"),text=$(this).text();
      if(value!=$("#select-language>span").attr("lan")){
          changelocale(value,function(data){
              if(data.result){
                  $("#select-language>span").attr("lan",value);
                  $("#select-language>span").text(text).attr("value",value);
                  window.location = data.content;
              }
          });
      }
  });
  function changelocale(value,callback){
      var data = {
          locale: value
      }

      $.ajax({
          url  : '/user_sessions/locale',
          data :data,
          type :'POST',
          async:false,
          success: function(data){
              if(callback){
                  callback(data);
              }
          }
      });
  }
</script>