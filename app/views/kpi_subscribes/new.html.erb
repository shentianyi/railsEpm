<div class="story-set-new kpi-subscribes-new">
  <p><%= t 'subscription.add'%></p>
  <div class="divide"></div>
  <div class="form">
    <p id="kpi-id" kpi-id="<%=@kpi.id%>"  class="kpi-title"><%= @kpi.name %></p>
    <p>部门</p>
    <select id="entity-groups" style="height: 30px; width:230px; margin: 5px;" class="chosen-select">
      <% @entity_groups.each do |entity_group| %>
          <option value="<%= entity_group.id %>"><%= entity_group.name %></option>
      <% end %>
    </select>
    <p>临界值</p>
    <div class="extreme">
      <select style="height: 30px; width:130px;margin: 5px" id="alert-type" class="chosen-select">
        <% SubscribeAlert.list_type.each do |menu|%>
            <option value="<%= menu[:type]%>"><%= menu[:display]%></option>
        <%end%>
      </select>
      <input type='text' id="value" placeholder="Value" />
      <ul id="alert-list" style="margin: 5px">
      </ul>
    </div>


    <p>时间范围</p>
    <div class="time-range">
      <input type='text' id="start-time" placeholder="Start" />
      <label></label>
      <input type='text' id="end-time" placeholder="End" />
      <label></label>
    </div>


    <a class="btn btn-primary" id="story-create-btn" onclick="MANAGE.kpi_subscribe.create()">create</a>
    <%= link_to 'cancel', mine_kpi_subscribes_path,:class=>"btn" %>
  </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        MANAGE.kpi_subscribe.init_new();

        var target = "#start-time,#end-time";
        var interval="200";

            new DATE_PICKER[interval](target, "date").datePicker();


        $("body").on("change", "#start-time",function () {
            var interval ="200";
            if (interval == "200") {
                var week = standardParse($(this).val()).date.toWeekNumber();
                $(this).next().text("week " + week);
            }
            else if (interval == "400") {
                var quarter = standardParse($(this).val()).date.monthToQuarter();
                $(this).next().text("quarter " + quarter);
            }
        }).on("change", "#end-time", function () {
                    var interval = "200";
                    if (interval == "200") {
                        var week = standardParse($(this).val()).date.toWeekNumber();
                        $(this).next().text("week " + week);
                    }
                    else if (interval == "400") {
                        var quarter = standardParse($(this).val()).date.monthToQuarter();
                        $(this).next().text("quarter " + quarter);
                    }
                });

    })
</script>
<% content_for :javascript_includes do %>
    <%= javascript_include_tag "kpi_subscribe_manage.js" %>
    <%= javascript_include_tag "bootstrap-datepicker.js" %>
    <%= javascript_include_tag "date_picker_template.js" %>
    <%= javascript_include_tag "bootstrap-datetimepicker.min.js" %>
<% end %>
