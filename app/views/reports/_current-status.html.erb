<section id="current-status">
  <section id="current-status-normal">
    <div class=" col-sm-12" id="current-status-header" style="background: #fefefe;border-bottom: 4px solid #000;">
      <div class="col-sm-4" style="padding-top: 10px;border-right: 1px solid #ccc;">
        <label>Condition</label>

        <p>WorkingTime Summary Percentage</p>

        <p id="current-date" style="font-size: 12px;"></p>
      </div>

      <div class="col-sm-4" style="padding-top: 10px;border-right: 1px solid #ccc;">
        <p>Product Line</p>
        <select id="vehicle-select" style="min-width: 200px;text-align: center;">
          <option value="Drum Assembly Line">Drum Assembly Line</option>
          <option value="Cabinet Assembly Line">Cabinet Assembly Line</option>
          <option value="Main Assembly Line">Main Assembly Line</option>
          <option value="Packaging Line">Packaging Line</option>
        </select>
      </div>
      <div class="col-sm-4" style="text-align: center;">
        <label>Current time</label>

        <p id="current-clock" style="font-size: 30px;font-weight: bold;"></p>
      </div>
    </div>

    <div class="col-sm-12">
        <ul class="pull-right control-chart-interval-group">
         <!--  <li interval="90">
            <a>Hr</a>
          </li> -->
          <li interval="100" style="color:black;" datatype='true'>
            <a>D</a>
          </li>
          <!-- <li interval="200">
            <a>W</a>
          </li> -->
          <li interval="300">
            <a>M</a>
          </li>
          <li interval="400">
            <a>Qr</a>
          </li>
          <li interval="500">
            <a>Y</a>
          </li>
        </ul>
        <!-- <a class="pull-right btn btn-warning linear compare-current-btn">WorkingTime</a> -->
    </div>
    <div id="data_container" class="data-container"></div>
  </section>

  <!--

    <section id="current-status-target" class='current-status-wrapper'>
      <div class="wrapper-header" id="target-wrapper-header">
        <a class="back-btn current-status-target-back-btn"><span>FTQ  Summary  Percentage</span></a>

        <p>Target setting</p>
      </div>
      <div id="target-setting-footer" class="target-setting-footer">
        <div class="footer-left">
          <p>Condition</p>

          <p>When Target higher than current FTQ</p>

          <p>When Target equal to current FTQ</p>

          <p>When Target lower than current FTQ</p>
        </div>
        <div class="footer-right" id="footer-right">
          <p>Color</p>
          <label>FTQ color setting</label>
        </div>
      </div>
      <div id="target_setting" class="wrapper-current-body"></div>
    </section>
    <section id="current-status-all-defects" class='current-status-wrapper'>
      <div class="wrapper-header">
        <a class="back-btn current-status-target-back-btn"><span>FTQ  Summary  Percentage</span></a>

        <p>All defects</p>
      </div>
      <div class="wrapper-current-body">
        <div id="all_defects" class="data_container"></div>
      </div>
    </section>
    <section id="current-status-key-defects" class='current-status-wrapper'>
      <div class="wrapper-header">
        <a class="back-btn current-status-target-back-btn"><span>FTQ  Summary  Percentage</span></a>

        <p>Key station defects</p>
      </div>
      <div class="wrapper-current-body">
        <div id="key_defects" class="data_container"></div>
      </div>
    </section>

  -->

</section>

<% content_for :javascript_includes do %>
    <%= javascript_include_tag "reports/current_status" %>
    <%= javascript_include_tag "reports/defects" %>
<% end %>

<script>
    $(document).ready(function () {
        $('.control-chart-interval-group li').each(function(index){
            $(this).click(function(){
                $('.control-chart-interval-group li').css({color:'black',opacity:'0.3'});
                $('.control-chart-interval-group li').attr('datatype','false');

                $(this).css({opacity:'1'});
                $(this).attr('datatype','true');

                console.log($(this).attr('interval'));
                console.log($('#vehicle-select').val());

                var Choose_Interval_Code=$(this).attr('interval');
                var ProductLine=$('#vehicle-select').val();
                $.ajax({
                    url:'/departments/entity_groups',
                    type:'get',
                    data:{
                        interval:Choose_Interval_Code,
                        product_line:ProductLine
                    },
                    success:function(data){
                        console.log(data);
                        //Here can do something
                    },
                    error:function(){
                        console.log("Error");
                    }
                });
            });
        });
//        Report.init("current_status");
        /*时间刷新*/
        window.setInterval(function () {
            $("#current-clock").text(format_time.current_time_clock());
        }, 700);

        /*设置整体背景颜色*/
//        var ClientHeight = document.documentElement.clientHeight;
        var ClientHeight = $(document).height();
        $('#report-content').css({
            height: (ClientHeight - 70) + 'px',
            overflow: 'auto'
        });

        loadData();
    });

    function loadData() {
        var productLine = $('#vehicle-select').val();
        var datatype=100;

        $('.control-chart-interval-group li').each(function(index){
            if($(this).attr('datatype')=='true'){
                datatype=$(this).attr('interval');
            }
        })
        
        console.log(productLine);
        loading_show();

        $.get('/departments/entity_groups', {product_line: productLine, interval: datatype}, function (data) {
            console.log(data);
            $('.workstation').remove();
            for (var i = 0; i < data.length; i++) {

                // console.log(data[i].value);
                // console.log(data[i].target_max);
                // console.log(data[i].target_min);

                if (data[i].value > data[i].target_max || data[i].value < data[i].target_min) {
                    $('<div class="col-md-3 workstation"><div class="box" ondblclick="double_click();">' +
                            '<div class="box-title">' + data[i].name + '</div><div style="display:inline-flex;width: 100%;"><div class="left-number" style="color: #ff0000;">' + data[i].value + '</div>' +
                            '<div class="right-content"><div class="content"><strong>' + data[i].target_max + '</strong><p>Max Target</p></div>' +
                            '<div class="content"><strong>' + data[i].target_min + '</strong><p>Min Target</p></div></div></div></div></div>').appendTo('#data_container').ready(function () {
                        loading_hide();
                    });
                } else {
                    $('<div class="col-md-3 workstation"><div class="box" ondblclick="double_click();">' +
                            '<div class="box-title">' + data[i].name + '</div><div style="display:inline-flex;width: 100%;"><div class="left-number"style="color: #3ed436;">' + data[i].value + '</div>' +
                            '<div class="right-content"><div class="content"><strong>' + data[i].target_max + '</strong><p>Max Target</p></div>' +
                            '<div class="content"><strong>' + data[i].target_min + '</strong><p>Min Target</p></div></div></div></div></div>').appendTo('#data_container').ready(function () {
                        loading_hide();
                    });
                }
            }
        }, 'JSON');
    }
    $("#vehicle-select").change(function () {
        loadData();
    });

    window.setInterval("loadData()", 20000);
    
    /*双击事件*/
    function double_click() {
        window.location.href = 'kpi_entries/analyse?view=' + $(this).children('div');
    }
</script>

<style>
    /*Box Start*/
    .box {
        min-width: 230px;
        height: 165px;
        border-radius: 10px;
        /*border: 2px solid #9000ff;*/
        border: 2px solid deepskyblue;
        margin: 10px;
        cursor: pointer;
    }

    .box-title {
        height: 50px;
        line-height: 50px;
        background: #545D70;
        color: #fefefe;
        font-size: 24px;
        text-align: center;
        border-top-right-radius: 7px;
        border-top-left-radius: 7px;
    }

    .left-number {
        font: 50px 'Helvetica';
        height: 100px;
        line-height: 100px;
        color: #3ed436;
        margin-left: 0;
        width: 55%;
        text-align: center;
    }

    .right-content {
        width: 45%;
        height: 100px;
        text-align: right;
        margin-right: 5px;
    }

    .content:first-child {
        margin: 5px 0 0 20px;
    }

    .content > strong {
        font: 24px 'Helvetica';
        color: #5c5c5c;
    }

    .content > p {
        font: 14px 'HelveticaCondensed';
        color: #bfbfbf;
    }

    /*Box End*/

    @font-face {
        font-family: 'HelveticaCondensed';
        src: url('/assets/HelveticaCondensed.eot');
        src: url('/assets/HelveticaCondensed.eot') format('embedded-opentype'),
        url('/assets/HelveticaCondensed.woff2') format('woff2'),
        url('/assets/HelveticaCondensed.woff') format('woff'),
        url('/assets/HelveticaCondensed.ttf') format('truetype'),
        url('/assets/HelveticaCondensed.svg#HelveticaCondensed') format('svg');
    }
</style>
