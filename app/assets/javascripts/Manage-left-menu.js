function category_add(){this.name="category",this.href="/kpis/",this.postHref="/kpi_categories"}function group_add(){this.name="部门",this.href="/users/index/",this.postHref="/entities"}function entity_add(){this.name="view",this.href="/entity_groups/index/",this.postHref="/entity_groups"}function dashboard_add(){this.name="dashboard",this.href="/dashboards?p=",this.postHref="/dashboards"}function entity_groups_add(){this.name="entity_groups",this.href="/entity_groups/index/",this.postHref="/entity_groups"}function category_delete(){this.url="/kpi_categories/",this.local="/kpis",this.name="category"}function group_delete(){this.url="/entities/",this.local="/users",this.name="group"}function entity_delete(){this.url="/entity_groups/",this.local="/entity_groups/",this.name="entity"}function dashboard_delete(){this.url="/dashboards/",this.local="/dashboards",this.name="dashboard"}function entity_groups_delete(){this.url="/entity_groups/",this.local="/entity_groups",this.name="entity_groups"}function category_edit(){this.url="/kpi_categories"}function group_edit(){this.url="/entities"}function entity_edit(){this.url="/entity_groups"}function dashboard_edit(){this.url="/dashboard"}function entity_groups_edit(){this.url="/entity_groups"}var MANAGE=MANAGE||{};MANAGE.manage_menu_left_delete=function(){},MANAGE.manage_menu_left_edit=function(){},MANAGE.manage_menu_left_add=function(){},MANAGE.category=MANAGE.category||{},MANAGE.group=MANAGE.group||{},MANAGE.entity=MANAGE.entity||{},MANAGE.entity_groups=MANAGE.entity_groups||{},MANAGE.dashboard=MANAGE.dashboard||{},MANAGE.left={},MANAGE.manage_menu_left_add.prototype={add_show:function(){$("#manage-left-menu li:nth-of-type(2) span").css("left","-999em"),$("#manage-left-menu li:nth-of-type(2) input").val("").css("left","8px").attr("placeholder",this.name).focus()},add_complete:function(){var validate=!1,name=$("#manage-menu-add input").val();if(0==$.trim(name).length)MANAGE.manage_menu_left_add.prototype.add_hide();else if($("#manage-left-menu li").each(function(){return $("#manage-menu-add input").val()==$(this).attr("title")?(validate=!1,!1):void(validate=!0)}),validate){var href=this.href;$.post(this.postHref,{data:{name:name}},function(data){data.result?($("#manage-menu-add input").val(""),MANAGE.manage_menu_left_add.prototype.add_hide(),MANAGE.left_count++,"category"==MANAGE.type?($("#manage-left-menu").append($("<li />").attr("title",name).attr("number",data.object).append($("<i />").addClass("icon-trash icon-item")).append($("<a/>").text(name))),$("#new-kpi-category").append($("<option />").attr("value",data.object).text(name)),$("#new-kpi-category").val("").trigger("chosen:updated")):$("#manage-left-menu").append($("<li />").attr("title",name).attr("number",data.object).append($("<i />").addClass("icon-trash icon-item")).append($("<a href='"+href+data.object+"'/>").text(name)))):MessageBox(data.content,"top","warning")})}else MessageBox("Same name exist yet","top","warning")},add_hide:function(){$("#manage-left-menu li:nth-of-type(2) span").css("left","0px"),$("#manage-left-menu li:nth-of-type(2) input").val("").css("left","-999em")},constructor:MANAGE.manage_menu_left_add},category_add.prototype=MANAGE.manage_menu_left_add.prototype,category_add.prototype.constructor=category_add,group_add.prototype=MANAGE.manage_menu_left_add.prototype,group_add.prototype.constructor=group_add,entity_add.prototype=MANAGE.manage_menu_left_add.prototype,entity_add.prototype.constructor=entity_add,dashboard_add.prototype=MANAGE.manage_menu_left_add.prototype,dashboard_add.prototype.constructor=dashboard_add,entity_groups_add.prototype=MANAGE.manage_menu_left_add.prototype,entity_groups_add.prototype.constructor=entity_groups_add,MANAGE.category.add=new category_add,MANAGE.group.add=new group_add,MANAGE.entity.add=new entity_add,MANAGE.dashboard.add=new dashboard_add,MANAGE.entity_groups.add=new entity_groups_add,MANAGE.left.manage_left_add_init=function(){$("#manage-menu-add").on("click",function(){MANAGE[MANAGE.type].add.add_show()}),$("#manage-menu-add input").on("keydown",function(event){13==adapt_event(event).event.keyCode?0==$.trim($(adapt_event(event).target).val())?MessageBox("it needs a name","top","warning"):MANAGE[MANAGE.type].add.add_complete():27==adapt_event(event).event.keyCode&&MANAGE[MANAGE.type].add.add_complete()}),$("#manage-menu-add input").blur(function(){MANAGE[MANAGE.type].add.add_complete()})},MANAGE.manage_menu_left_delete.prototype={delete_complete:function(e){var number=$(e.target).parent().attr("number"),local=this.local;$.ajax({url:this.url+number,type:"DELETE",success:function(data){data.result?("category"==MANAGE.type&&($("#new-kpi-category option").each(function(){return $(this).attr("value")==number?($(this).remove(),!1):void 0}),$("#new-kpi-category").val("").trigger("chosen:updated")),window.location.href=local,MANAGE.left_count--):MessageBox(data.content,"top","warning")}})},constructor:MANAGE.manage_menu_left_delete},category_delete.prototype=MANAGE.manage_menu_left_delete.prototype,category_delete.prototype.constructor=category_delete,group_delete.prototype=MANAGE.manage_menu_left_delete.prototype,group_delete.prototype.constructor=group_delete,entity_delete.prototype=MANAGE.manage_menu_left_delete.prototype,entity_delete.prototype.constructor=entity_delete,dashboard_delete.prototype=MANAGE.manage_menu_left_delete.prototype,dashboard_delete.prototype.constructor=dashboard_delete,entity_groups_delete.prototype=MANAGE.manage_menu_left_delete.prototype,entity_groups_delete.prototype.constructor=entity_groups_delete,MANAGE.category.delete=new category_delete,MANAGE.group.delete=new group_delete,MANAGE.entity.delete=new entity_delete,MANAGE.dashboard.delete=new dashboard_delete,MANAGE.entity_groups.delete=new entity_groups_delete,MANAGE.left.manage_left_delete_init=function(){$("#manage-left-menu").on("click","i.icon-trash",function(event){if(confirm(I18n.t("manage.base.delete_confirm"))){var e=adapt_event(event).event;MANAGE[MANAGE.type].delete.delete_complete(e)}})},MANAGE.manage_menu_left_edit.prototype={edit_show:function(name){$("#manage-edit-target").blur().css("display","none"),$("#manage-btn-group>input").val(name).css("display","inline-block").focus()},edit_check:function(e){if($.trim($(e.target).val()).length>0){var validate=!0;return $(e.target).val()==$("#manage-left-menu li.active>a").text()?(this.edit_hide(),!1):($("#manage-left-menu li>a").each(function(){return $(this).text()==$(e.target).val()?(validate=!1,MessageBox("Same name exist yet","top","warning"),!1):void 0}),validate)}return MessageBox("give it a name","top","warning"),!1},edit_update:function(){var id=$("#manage-left-menu li.active").attr("number"),name=$("#manage-btn-group>input").val();$("#manage-edit-target").text(name),$.ajax({url:this.url,type:"PUT",data:{id:id,data:{name:name}},async:!1,success:function(data){data&&(alert(data),$("#manage-left-menu li.active>a").text(name),$("#manage-left-menu li.active").attr("title",name),$("#manage-edit-target").text(name),"category"==MANAGE.type&&($("#new-kpi-category option").each(function(){return $(this).attr("value")==id?($(this).text(name),!1):void 0}),$("#new-kpi-category").val("").trigger("chosen:updated")))}}),this.edit_hide()},edit_hide:function(){$("#manage-edit-target").css("display","inline-block"),$("#manage-btn-group>input").css("display","none")},constructor:MANAGE.manage_menu_left_edit},category_edit.prototype=MANAGE.manage_menu_left_edit.prototype,category_edit.prototype.constructor=category_edit,group_edit.prototype=MANAGE.manage_menu_left_edit.prototype,group_edit.prototype.constructor=group_edit,entity_edit.prototype=MANAGE.manage_menu_left_edit.prototype,entity_edit.prototype.constructor=entity_edit,dashboard_edit.prototype=MANAGE.manage_menu_left_edit.prototype,dashboard_edit.prototype.constructor=dashboard_edit,entity_groups_edit.prototype=MANAGE.manage_menu_left_edit.prototype,entity_groups_edit.prototype.constructor=entity_groups_edit,MANAGE.category.edit=new category_edit,MANAGE.group.edit=new group_edit,MANAGE.entity.edit=new entity_edit,MANAGE.dashboard.edit=new dashboard_edit,MANAGE.entity_groups.edit=new entity_groups_edit,MANAGE.left.manage_left_edit_init=function(){$("#manage-edit-target").text($("#manage-left-menu li.active").find("a").text()).on("click",function(){var name=$.trim($(this).text());MANAGE[MANAGE.type].edit.edit_show(name)}),$("#manage-btn-group").on("keyup","input",function(event){var e=adapt_event(event).event;13==e.keyCode?0==$.trim($(e.target).val())?MessageBox("give it a name","top","warning"):$(this).blur():27==e.keyCode&&MANAGE[MANAGE.type].edit.edit_check(e)&&MANAGE[MANAGE.type].edit.edit_update()}),$("#manage-btn-group>input").blur(function(event){var e=adapt_event(event).event;MANAGE[MANAGE.type].edit.edit_check(e)&&MANAGE[MANAGE.type].edit.edit_update()})};